{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "A Sample JSON that is going to spin up an EC2 instance and install apache on it",
  "Parameters": {
    "AWSKeyPair": {
      "Description": " A working AWS keypair to run the EC2 credentials ",
      "Type": "AWS::EC2::KeyPair::KeyName",
      "ConstraintDescription": "Must be the name of the existing keyPair"
    },
    "SSHLocation": {
     "Description": " The IP address range that can be used to SSH to the EC2 instances",
     "Type": "String",
     "MinLength": "9",
     "MaxLength": "18",
     "Default": "0.0.0.0/0",
     "AllowedPattern": "(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})/(\\d{1,2})",
     "ConstraintDescription": "must be a valid IP CIDR range of the form x.x.x.x/x."
   },
   "InstanceType" : {
     "Description" : "WebServer EC2 instance type",
     "Type" : "String",
     "Default" : "t2.micro",
     "AllowedValues" : [ "t2.micro"],
     "ConstraintDescription" : "must be a valid EC2 instance type."
   }
  },
  "Resources": {
    "EC2Instance": {
      "Description": "The sample EC2 instance that will be generated",
      "Type": "AWS::EC2::Instance",
      "Metadata" : {
       "AWS::CloudFormation::Init" : {
         "configSets" : {
           "InstallAndRun" : [ "Install", "Configure" ]
         },

         "Install" : {
           "packages" : {
             "yum" : {
               "httpd"        : [],
               "php"          : []
             }
           },

           "files" : {
             "/var/www/html/index.php" : {
               "content" : { "Fn::Join" : [ "", [
                 "<html>\n",
                 "  <head>\n",
                 "    <title>AWS CloudFormation PHP Sample</title>\n",
                 "    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=ISO-8859-1\">\n",
                 "  </head>\n",
                 "  <body>\n",
                 "    <h1>Welcome to the AWS CloudFormation PHP Sample</h1>\n",
                 "    <p/>\n",
                 "    <?php\n",
                 "      // Print out the current data and time\n",
                 "      print \"The Current Date and Time is: <br/>\";\n",
                 "      print date(\"g:i A l, F j Y.\");\n",
                 "    ?>\n",
                 "  </body>\n",
                 "</html>\n"
               ]]},
               "mode"  : "000600",
               "owner" : "apache",
               "group" : "apache"
             }
           }
         }
       }
     }
    }
  },
  "Outputs": {
    "InstanceID": {
      "Description": "The instance ID of the machine that has spun up",
      "Value": "EC2Instance"
    }
  }
}
